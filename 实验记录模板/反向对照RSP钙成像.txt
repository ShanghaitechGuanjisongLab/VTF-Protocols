实验背景：在行为学实验中发现合并迁移学习比初始学习更快。实验室以前的研究中发现小鼠皮层2/5层对不同的场景有特异性响应。于是猜测皮层2/5层可能参与到迁移学习加速的过程中。在之前对运动皮层的研究中发现，迁移学习完成后，响应初始刺激的细胞群体，不同于刚完成初始学习后的响应群体。这种群体迁移现象是迁移学习造成的，还是单纯的训练积累？
实验目的：在小鼠学习合并迁移基本范式的过程中，记录RSPd2/5层神经元活动的钙信号，探究神经系统执行迁移学习的原理，特别是观察初始学习完成后继续进行初始训练的积累，能否继续改变群体响应。

# 实验材料
完成RSPd2/5层注射pAAV-hSyn-GCaMP6f，和RSPd5层pAAV-hSyn-hM4D(Gi)-mCherry，开窗上架手术后恢复至少3周的小鼠。
小鼠固定床、三折擦手纸、六角螺丝刀、75%乙醇、棉签、牙签、小手电、双光子显微镜设备系统、盐酸金霉素眼膏、纯净水、滴管、两台计算机（双光子主机、双光子辅助机）、小鼠灌胃针、橡胶管、蠕动水泵、水瓶、杜邦线、5V-12V升压板、Arduino Mega 2560 开发板、触感电容、有源蜂鸣器

# 设备部署
小鼠通过头架固定在床上，嘴前放置灌胃针，使得小鼠能且仅能伸舌头恰好碰到针头。灌胃针管后部连接橡胶管，橡胶管连接蠕动水泵，水泵另一端连接水瓶，这样水泵开动时就可以从水瓶抽水，水珠悬挂在灌胃针上，小鼠伸舌头就能舔到。水泵的正负电极通过杜邦线连接到5V-12V升压板的12V端，5V端连接Arduino开发板控制。
此外，灌胃针外还缠绕铜线圈，通过杜邦线连接到触感电容。这样小鼠舌头触碰针头时，触感电容就会感应到，发送信号给Arduino。
蓝色LED灯放在小鼠右眼旁，连接Arduino开发板控制。有源蜂鸣器放在小鼠耳畔，正负极连接Arduino开发板控制。
——————————————
# 实验方法
——————————————
双光子显微镜配备专用的显微镜室，严格控制气温和湿度。启动任何设备之前，先检查空调和除湿机是否正常工作：空调是否出错需要重启、报修，除湿机是否水满需要倒水。

## 启动显微镜设备
启动相关设备，分7个模块。其中1和6位于同一台设备上，3是汞灯，7是Piezo。1、2、4是切翻式开关，3在面板右下角有单键ON/OFF开关，5在右后上方有按钮式开关，6是旋转钥匙开关，7在后端有一个切翻式开关，前端有左右2个拨杆式开关。
启动时，先顺序打开1~3，然后静静聆听机器启动声音。应该会有2道低沉1道高亢，共3声长音。声音结束后可开4，4会发出一声短音表示启动完成，然后开5。5的屏幕上会逐渐显示启动过程，等待，直到出现【Start Operation →】界面，表示启动完成。然后依次打开6和7。开7时，先开后端的切翻式开关，再开前端左侧的拨杆式开关。一般不动右侧拨杆。
在双光子主机上打开 OLYMPUS FV31S-SW 软件。等待加载一段时间后，出现 HW Configuration 对话框。勾选 Scanner \ Initialize resonant scanner 和 PZT Z Stage \ Enable PZT Z stage control 两项，其它均不勾选。然后点击OK。
启动红外激光发射器。首先切换Ocular面板，选中LSM；然后切换 PMT Setting 面板，注意到黄色文字提示 Please turn on the laser，说明激光未开。此时在顶端菜单中选择Tools\Configuration，打开Configuration对话框。Configuration对话框中，选择 Preference \ IR laser emission \ Emission status \ On，务必勾选 Shut down the software with IR laser emission ON 以免造成意外的激光开关，然后OK，激光即可打开。打开激光后，可以看到 PMT Setting 面板中的黄字变成Tuning。等待一段时间后，黄字消失，激光进入正常工作状态。
选择染料和检测器。在 PMT Setting 面板中点选 Dye & Detector Select，打开 Dye and Detector Select 对话框。Detector List 中列出了当前可选使用的检测器。选择要使用的检测器：
- Ref. Non-Descanned Detector CH4 (GaAsP)，一般用于绿色荧光检测。此检测器有简称曰RNDD4G
- Current Detector CH1，电流检测器，一般用于打标。此检测器有简称曰CD1
- Current Detector CH2，电流检测器，一般用于打标。此检测器有简称曰CD2
点击Add添加到 Assigned Dye 列表中，该列表以简称显示检测器。在 Assigned Dye 列表中选中检测器，点击Remove可以移除选择，或者 All Clear 清除选择。点OK确认选择。确认选择检测器后，PMT Setting 面板中会列出被选中的检测器。对于荧光检测通道，此处还需要选择激光通路，而不是保留默认的None。激光通过率和放大电压用来调节图像亮度参数。通过率越高图像越亮越清晰，但过高容易灼伤拍摄目标。放大电压越大图像越亮，但噪音也会随之放大，信噪比降低。此外，图像亮度过高也可能会导致检测器过曝，丢失信息。
设置激光波长需要使用 IR Laser Setting 面板。将 Preset alignment 设为需要的激发光波长。例如GCaMP6f需要960㎚激发光。其它设置一般不改。

## 放置小鼠，调整拍摄图面
将三折擦手纸卷曲垫在小鼠固定床上，将小鼠头架两翼对称地夹在固定床卡口中，螺丝旋紧。乙醇浸润棉签后涂抹在颅窗玻璃表面，擦去浮尘污垢等，顽固污渍可用牙签轻轻刮除。用小手电照耀玻璃表面，观察反光，反光明亮清晰平滑，说明玻璃表面已经擦干净了。用牙签蘸取眼膏，在窗周围一圈涂抹，作为防水层，然后用滴管滴入纯净水，形成凸透镜形状。将小鼠和固定床一起放在物镜下，镜头浸没在水滴凸透镜中。
在软件Ocular面板中选中Ocular，这样显微镜控制权从计算机转交到设备5的触屏。
关灯，在控制面板上打开Shutter，选择GFP，镜头即射出蓝光。在目镜中观察，调节XY平移螺旋和Z粗准焦螺旋，直至找到明亮绿色、血管清晰可见的视野。如果找不到这样的视野，说明成像窗质量较差，可能无法成像，只能去做行为。
找到视野后，调整遮光帘、舔水管、灯、蜂鸣器等的位置，使其能够恰当地作用于小鼠。在双光子辅助机上，打开[通用行为实验控制](https://github.com/ShanghaitechGuanjisongLab/Generic-Behavioural-Experimental-Control)软件，使用Development_Client上传Arduino代码，在SelfCheck_Client中测试光、声、水泵、电容传感器，是否工作正常。一切正常后，在Experiment_Client中输入当天要进行的会话设计和鼠号。
如果不正常，请参考前面故障排除相关排除故障。

找到成像面后，在软件Ocular面板中选择LSM，控制权回到计算机。关闭房间照明灯，闭合遮光帘。
在 PMT Setting 面板中打开荧光检测器，然后转到 LSM Imaging 面板。在LSM Imaging \ Scan Settings \ Scanner \ Type 中选择Resonant。相比于Galvano，这种扫描仪信噪比较低，但速度快，适合于我们寻找成像面时快速预览的要求。然后Scanner\Mode中选择Roundtrip，意思是逐行S形来回扫描；而OneWay意味着每一行都是从左到右扫描。Roundtrip比OneWay扫描更快，但S形来回折返时可能会发生错位，因此需要设置 LSM Imaging \ Round trip correction，一般设为10左右，以后如果发现图像行之间有错位可以微调。
Area Settings \ Zoom 可用于数字放大，如果发现图像放大倍数异常可以检查一下该项设置。
回到 PMT Setting，打开快门。将放大电压和激光通过率设为较低水平（一般10%以下），以免灼伤拍摄目标或过曝。然后在Live面板中点击Live查看实时预览。调节硬件XYZ和 PMT Setting 中的亮度参数，直到成像面清晰。然后打开Live的隐藏面板，在LUT选项卡下，将Min和Max都设为1023，此时成像区内如有亮点，说明发生了过曝，可以适当调低亮度参数避免过曝。如果要完全避免局部过曝，又可能导致图像整体过暗，因此需要权衡。此外，Resonant扫描仪噪音较高，少数过曝点可能是噪音所致。因此调节亮度前，可以在 LSM Imaging 面板中选择Galvano扫描仪，降低噪音过曝。

## 拍摄参照图
为了方便配准，先拍摄一张静态参照图作为配准标准。
一般使用Galvano扫描仪拍摄静态图像。显微镜并不能同时拍摄多层，只能一层一层拍摄。所谓的多层动态，其实是镜头在多层之间迅速切换。因此，开始拍摄之前，软件必须记录每一层的Z深度，以及相应的亮度参数。
设置Z层需要用到Series面板的 Z Section 功能区。Motor有三个类型，其中PZT能够使镜头以最快的速度小范围移动，这是动态图像所需的特性。
我们需要拍摄运动皮层2/5层。首先完成2层图面的调节（位置、亮度等参数都调好），然后在 Z Section 中将Motor类型设为PZT，点击 Origin Register，使得当前Motor位置为Motor Origin。此时，Motor位置、PZT和Start这3个参数都应为0。如果PZT不为0，需将 Step Size 设为PZT当前值，然后点击PZT向上一层按钮，使PZT归零。如果Start不为0，可直接输入0。
完成设置后，为了将这个设置记录下来，又需要用到 Bright Z 面板。点击Register将当前Z层亮度参数记录下来，Delete可以删除一层参数，Delete all 清空所有参数。为了应用所记录的参数，必须将 During Z-series 和 During manual Z 都设为 ON。
点击 Delete all 将其他人的设置清空，然后点Register将当前设置记录。这样2层就被软件记录好了。然后回到Series的 Z Section 功能区。
调节粗准焦螺旋，调到要拍的5层位置。5层通常在2层下方250㎛左右，特点是细胞形态较大。但先不急调亮度参数。由于 Motor Origin 在2层，此时将5层的位置和亮度参数调好后，Motor位置显示的就是5层与2层的距离。接下来务必严格按照顺序执行以下数值配置：
1.	将Step Size 设为Motor位置与End的最大公约数。
2.	将End设为Motor位置的值。
3.	将Slices设为2。
这三个设置项相互关联且各有范围限制，如果一项设置会使得关联的另一项设置超出范围，这项设置就会失败。因此必须按照特定顺序设置才能回避这些范围限制。我们要拍间隔250㎛的两层，那么设置完成后Motor位置、Step Size 和End都应为250，Slices为2。
点击Motor向上一层，然后PTZ向下一层，使得Motor位置变为0而PZT 变为250。因为实际的Z深度是 Motor Origin + Motor + PZT，所以此时镜头仍聚焦在5层的深度。现在再调节亮度参数，然后在 Bright Z 中Register。Bright Z 会将当前PZT记录为 Z Pos，因此必须通过上述操作将Motor位置转换为PZT才能被记录。
将Series\LSM中的Time设为OFF，Z设为ON。找到Acquire面板，在Normal\LSM中，浏览设置输出目录和输出文件名（不设置扩展名，会自动添加.oir扩展名）。如果存在重名文件，不会发生覆盖，而是会自动添加编号。文件名格式：<鼠号>.<日期时间yyyyMMddHHmm>.Reference.<亮度参数>。如：`0030.202207171937.Reference.10%350V20%350V`。点击 Imaging \ LSM Start 完成拍摄。

## 正式开拍
一般使用Resonant扫描仪拍摄动态图像。
将Series\LSM中的Time设为ON。在 Time Lapse 中将Cycle设为采样时点数。如果拍摄前不确定要拍多久，可以设为最大值65535。
在双光子辅助机上，运行Experiment_Client.mlx脚本，程序会提示确认，并显示当前日期时间。先不急确认。在双光子主机上，Normal\LSM中，将文件名设为：<鼠号>.<日期时间>.<会话名称>.<亮度参数>，其中日期时间字段设为与双光子辅助机MATLAB命令行中显示的日期时间相同。如：`0030.202207171937.LAWLwAw.10%350V20%350V`
漏光测试。在成像过程中，涉及到蓝光闪光的，注意观察蓝光闪时，是否会影响拍摄，即出现漏光的现象。如果出现这种情况，应该调整幕布的位置，使得幕布遮挡住镜头不受蓝光干扰。
点击 Imaging \ LSM Start 开始拍摄，随后在双光子辅助机上确认实验开始。实验进入自动运行阶段。
动态图像拍摄中，可随时点击 Acquire \ Normal \ LSM Stop 停止拍摄。Live面板可选Tile子面板，同时查看荧光和电流检测各通道；也可选Single面板查看单个通道。
打标需要用到额外的输入设备。将标信号源Arduino通过杜邦-BNC转接头连接到收发器电流输入端口。
拍摄过程中可以看到成像面不断在两层之间切换，亮度参数也在不断迅速随之切换，物镜也会在拍摄目标上方上下抖动，三者的周期和相位完全相同。
偶尔也会出现异常情况，Piezo设备输出的振荡信号漏了半拍，就会导致两层反相，现象是成像出现异常的亮度，过曝或是过暗。因此拍摄中应当不时确认工作状态是否正常，如有异常应立即停止拍摄重新启动。
在成像过程中，可以用摄像机监视小鼠的舔水行为，如果发现小鼠舔水了但相应通道未记录，或者舔水管子因为小鼠拨弄等原因歪了造成舔水困难等情况要及时调整。

## 会话结束，关闭设备
在 PMT Setting 面板中关闭所有检测器的快门。在Ocular面板中选择Ocular。在 Tools \ Configuration \ Preference \ IR laser emission \ Emission status 中选择Off，然后点OK。
在设备5触摸屏上按住Z向上按钮，直到物镜抬升到顶。有时机械顶端和软件顶端会错位，抬升时会报错，忽略。物镜抬升后可以移除小鼠。
在计算机上关闭 OLYMPUS FV31S-SW 软件，会提示 Do you want to exit? 点OK。
如果电脑上已经关闭了软件才发现忘记在设备5上抬升物镜了，可以在触摸屏上点击 Start Operation 重新进入可调界面，完成抬升物镜操作。
关闭设备7，先关前端左侧拨杆式开关，再关后端切翻式开关。关6。关5时仍按后右上方按钮，可能会稍有延迟，等熄屏即可。关4。关3时需要长按开关1s再松手才能关掉。最后依次关闭2和1。
离开房间前需检查操作台上悬挂的黑色遮光帘，应当闭合。抽水机如果水满要倒水。出门随手关灯。
——————————————
# 基本训练回合
不同于基本范式，在反向对照中不做多种刺激扫描，而是纯粹的迁移学习，但在初始学习完成后，还要继续做3个会话，观察持续积累已完成的训练是否仍会改变细胞群体活动，那之后再进行迁移。
偶联刺激（光-水，声-水）：给200㎳刺激，等待800㎳，然后给水150ms。在这前后一共1s时间内，如果舔了，记为命中；若未舔，记为错失。（无论舔不舔都给水）等待20s，然后等待小鼠在随机5~10s之内没有舔水行为，开始下一回合

# 实验日志
停止给小鼠供给饮用水36小时后开始实验。本实验分为多个会话。每个会话之间间隔12小时左右。
记录格式：日期时间	鼠号	实验内容	备注